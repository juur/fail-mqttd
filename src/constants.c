#include "mqtt.h"
#include "config.h"

const mqtt_payload_required mqtt_packet_to_payload[MQTT_CP_MAX] = {
    [MQTT_CP_CONNECT]     = MQTT_PAYLOAD_REQUIRED,
    [MQTT_CP_CONNACK]     = MQTT_PAYLOAD_NONE,
    [MQTT_CP_PUBLISH]     = MQTT_PAYLOAD_OPTIONAL,
    [MQTT_CP_PUBACK]      = MQTT_PAYLOAD_NONE,
    [MQTT_CP_PUBREC]      = MQTT_PAYLOAD_NONE,
    [MQTT_CP_PUBREL]      = MQTT_PAYLOAD_NONE,
    [MQTT_CP_PUBCOMP]     = MQTT_PAYLOAD_NONE,
    [MQTT_CP_SUBSCRIBE]   = MQTT_PAYLOAD_REQUIRED,
    [MQTT_CP_SUBACK]      = MQTT_PAYLOAD_REQUIRED,
    [MQTT_CP_UNSUBSCRIBE] = MQTT_PAYLOAD_REQUIRED,
    [MQTT_CP_UNSUBACK]    = MQTT_PAYLOAD_REQUIRED,
    [MQTT_CP_PINGREQ]     = MQTT_PAYLOAD_NONE,
    [MQTT_CP_PINGRESP]    = MQTT_PAYLOAD_NONE,
    [MQTT_CP_DISCONNECT]  = MQTT_PAYLOAD_NONE,
    [MQTT_CP_AUTH]        = MQTT_PAYLOAD_NONE,
};

const uint8_t mqtt_packet_permitted_flags[MQTT_CP_MAX] = {
    [MQTT_CP_CONNECT]     = ~0x0,
    [MQTT_CP_CONNACK]     = ~0x0,
    [MQTT_CP_PUBLISH]     = ~0xf,
    [MQTT_CP_PUBACK]      = ~0x0,
    [MQTT_CP_PUBREC]      = ~0x0,
    [MQTT_CP_PUBREL]      = ~0x2,
    [MQTT_CP_PUBCOMP]     = ~0x0,
    [MQTT_CP_SUBSCRIBE]   = ~0x2,
    [MQTT_CP_SUBACK]      = ~0x0,
    [MQTT_CP_UNSUBSCRIBE] = ~0x2,
    [MQTT_CP_UNSUBACK]    = ~0x0,
    [MQTT_CP_PINGREQ]     = ~0x0,
    [MQTT_CP_PINGRESP]    = ~0x0,
    [MQTT_CP_DISCONNECT]  = ~0x0,
    [MQTT_CP_AUTH]        = ~0x0,
};

const char *const mqtt_packet_type_strings[MQTT_CP_MAX] = {
    [MQTT_CP_CONNECT]     = "CONNECT",
    [MQTT_CP_CONNACK]     = "CONNACK",
    [MQTT_CP_PUBLISH]     = "PUBLISH",
    [MQTT_CP_PUBACK]      = "PUBACK",
    [MQTT_CP_PUBREC]      = "PUBREC",
    [MQTT_CP_PUBREL]      = "PUBREL",
    [MQTT_CP_PUBCOMP]     = "PUBCOMP",
    [MQTT_CP_SUBSCRIBE]   = "SUBSCRIBE",
    [MQTT_CP_SUBACK]      = "SUBACK",
    [MQTT_CP_UNSUBSCRIBE] = "UNSUBSCRIBE",
    [MQTT_CP_UNSUBACK]    = "UNSUBACK",
    [MQTT_CP_PINGREQ]     = "PINGREQ",
    [MQTT_CP_PINGRESP]    = "PINGRESP",
    [MQTT_CP_DISCONNECT]  = "DISCONNECT",
    [MQTT_CP_AUTH]        = "AUTH",
};

const mqtt_types mqtt_property_to_type[MQTT_MAX_PROPERTY_IDENT] = {
    [MQTT_PROP_PAYLOAD_FORMAT_INDICATOR]          = MQTT_TYPE_BYTE,
    [MQTT_PROP_MESSAGE_EXPIRY_INTERVAL]           = MQTT_TYPE_4BYTE,
    [MQTT_PROP_CONTENT_TYPE]                      = MQTT_TYPE_UTF8_STRING,
    [MQTT_PROP_RESPONSE_TOPIC]                    = MQTT_TYPE_UTF8_STRING,
    [MQTT_PROP_CORRELATION_DATA]                  = MQTT_TYPE_BINARY,
    [MQTT_PROP_SUBSCRIPTION_IDENTIFIER]           = MQTT_TYPE_VARBYTE,
    [MQTT_PROP_SESSION_EXPIRY_INTERVAL]           = MQTT_TYPE_4BYTE,
    [MQTT_PROP_ASSIGNED_CLIENT_IDENTIFIER]        = MQTT_TYPE_UTF8_STRING,
    [MQTT_PROP_SERVER_KEEP_ALIVE]                 = MQTT_TYPE_2BYTE,
    [MQTT_PROP_AUTHENTICATION_METHOD]             = MQTT_TYPE_UTF8_STRING,
    [MQTT_PROP_AUTHENTICATION_DATA]               = MQTT_TYPE_BINARY,
    [MQTT_PROP_REQUEST_PROBLEM_INFORMATION]       = MQTT_TYPE_BYTE,
    [MQTT_PROP_WILL_DELAY_INTERVAL]               = MQTT_TYPE_4BYTE,
    [MQTT_PROP_REQUEST_RESPONSE_INFORMATION]      = MQTT_TYPE_BYTE,
    [MQTT_PROP_RESPONSE_INFORMATION]              = MQTT_TYPE_UTF8_STRING,
    [MQTT_PROP_SERVER_REFERENCE]                  = MQTT_TYPE_UTF8_STRING,
    [MQTT_PROP_REASON_STRING]                     = MQTT_TYPE_UTF8_STRING,
    [MQTT_PROP_RECEIVE_MAXIMUM]                   = MQTT_TYPE_2BYTE,
    [MQTT_PROP_TOPIC_ALIAS_MAXIMUM]               = MQTT_TYPE_2BYTE,
    [MQTT_PROP_TOPIC_ALIAS]                       = MQTT_TYPE_2BYTE,
    [MQTT_PROP_MAXIMUM_QOS]                       = MQTT_TYPE_BYTE,
    [MQTT_PROP_RETAIN_AVAILABLE]                  = MQTT_TYPE_BYTE,
    [MQTT_PROP_USER_PROPERTY]                     = MQTT_TYPE_UTF8_STRING_PAIR,
    [MQTT_PROP_MAXIMUM_PACKET_SIZE]               = MQTT_TYPE_4BYTE,
    [MQTT_PROP_WILDCARD_SUBSCRIPTION_AVAILABLE]   = MQTT_TYPE_BYTE,
    [MQTT_PROP_SUBSCRIPTION_IDENTIFIER_AVAILABLE] = MQTT_TYPE_BYTE,
    [MQTT_PROP_SHARED_SUBSCRIPTION_AVAILABLE]     = MQTT_TYPE_BYTE,
};

const char *const mqtt_property_strings[MQTT_MAX_PROPERTY_IDENT] = {
    [MQTT_PROP_PAYLOAD_FORMAT_INDICATOR]          = "PAYLOAD_FORMAT_INDICATOR",
    [MQTT_PROP_MESSAGE_EXPIRY_INTERVAL]           = "MESSAGE_EXPIRY_INTERVAL",
    [MQTT_PROP_CONTENT_TYPE]                      = "CONTENT_TYPE",
    [MQTT_PROP_RESPONSE_TOPIC]                    = "RESPONSE_TOPIC",
    [MQTT_PROP_CORRELATION_DATA]                  = "CORRELATION_DATA",
    [MQTT_PROP_SUBSCRIPTION_IDENTIFIER]           = "SUBSCRIPTION_IDENTIFIER",
    [MQTT_PROP_SESSION_EXPIRY_INTERVAL]           = "SESSION_EXPIRY_INTERVAL",
    [MQTT_PROP_ASSIGNED_CLIENT_IDENTIFIER]        = "ASSIGNED_CLIENT_IDENTIFIER",
    [MQTT_PROP_SERVER_KEEP_ALIVE]                 = "SERVER_KEEP_ALIVE",
    [MQTT_PROP_AUTHENTICATION_METHOD]             = "AUTHENTICATION_METHOD",
    [MQTT_PROP_AUTHENTICATION_DATA]               = "AUTHENTICATION_DATA",
    [MQTT_PROP_REQUEST_PROBLEM_INFORMATION]       = "REQUEST_PROBLEM_INFORMATION",
    [MQTT_PROP_WILL_DELAY_INTERVAL]               = "WILL_DELAY_INTERVAL",
    [MQTT_PROP_REQUEST_RESPONSE_INFORMATION]      = "REQUEST_RESPONSE_INFORMATION",
    [MQTT_PROP_RESPONSE_INFORMATION]              = "RESPONSE_INFORMATION",
    [MQTT_PROP_SERVER_REFERENCE]                  = "SERVER_REFERENCE",
    [MQTT_PROP_REASON_STRING]                     = "REASON_STRING",
    [MQTT_PROP_RECEIVE_MAXIMUM]                   = "RECEIVE_MAXIMUM",
    [MQTT_PROP_TOPIC_ALIAS_MAXIMUM]               = "TOPIC_ALIAS_MAXIMUM",
    [MQTT_PROP_TOPIC_ALIAS]                       = "TOPIC_ALIAS",
    [MQTT_PROP_MAXIMUM_QOS]                       = "MAXIMUM_QOS",
    [MQTT_PROP_RETAIN_AVAILABLE]                  = "RETAIN_AVAILABLE",
    [MQTT_PROP_USER_PROPERTY]                     = "USER_PROPERTY",
    [MQTT_PROP_MAXIMUM_PACKET_SIZE]               = "MAXIMUM_PACKET_SIZE",
    [MQTT_PROP_WILDCARD_SUBSCRIPTION_AVAILABLE]   = "WILDCARD_SUBSCRIPTION_AVAILABLE",
    [MQTT_PROP_SUBSCRIPTION_IDENTIFIER_AVAILABLE] = "SUBSCRIPTION_IDENTIFIER_AVAILABLE",
    [MQTT_PROP_SHARED_SUBSCRIPTION_AVAILABLE]     = "SHARED_SUBSCRIPTION_AVAILABLE",
};
